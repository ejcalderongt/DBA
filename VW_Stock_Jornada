ALTER VIEW [dbo].[VW_Stock_Jornada] AS
SELECT        dbo.stock.IdBodega, dbo.stock.IdStock, dbo.stock.IdPropietarioBodega, dbo.stock.IdProductoBodega, dbo.stock.IdProductoEstado, dbo.stock.IdPresentacion, dbo.stock.IdUnidadMedida, dbo.stock.IdUbicacion, 
                         dbo.stock.IdUbicacion_anterior, dbo.stock.IdRecepcionEnc, dbo.stock.IdRecepcionDet, dbo.stock.IdPedidoEnc, dbo.stock.IdPickingEnc, dbo.stock.IdDespachoEnc, dbo.stock.lote, dbo.stock.lic_plate, dbo.stock.serial, 
                         dbo.stock.cantidad, dbo.stock.fecha_ingreso, dbo.stock.fecha_vence, dbo.stock.uds_lic_plate, dbo.stock.no_bulto, dbo.stock.fecha_manufactura, dbo.stock.añada, dbo.stock.user_agr, dbo.stock.fec_agr, dbo.stock.user_mod, 
                         dbo.stock.fec_mod, dbo.stock.activo, dbo.stock.peso, dbo.stock.temperatura, dbo.stock.atributo_variante_1, dbo.stock.pallet_no_estandar, dbo.propietarios.nombre_comercial AS Propietario, 
                         dbo.proveedor.nombre AS Proveedor, dbo.bodega.nombre AS Bodega, dbo.trans_oc_enc.IdOrdenCompraEnc, dbo.trans_oc_enc.No_Documento AS No_DocumentoOC, dbo.trans_oc_enc.Referencia AS No_DocumentoRec, 
                         dbo.trans_re_oc.no_docto AS ReferenciaOC, dbo.trans_re_enc.fecha_recepcion, dbo.trans_re_tr.TipoTrans, dbo.unidad_medida.Nombre AS Nom_umBas, dbo.producto.codigo AS Codigo_Producto, 
                         dbo.producto.nombre AS Nombre_Producto, dbo.producto.codigo_barra AS Codigo_Barra_Producto, 
                         CASE WHEN dbo.stock.IdPresentacion <> 0 THEN dbo.stock.cantidad / dbo.producto_presentacion.factor ELSE dbo.stock.cantidad END AS Existencia, ISNULL(dbo.producto_presentacion.factor, 0) AS Factor, 
                         ISNULL(dbo.producto_presentacion.CamasPorTarima, 0) AS CamasPorTarima, ISNULL(dbo.producto_presentacion.CajasPorCama, 0) AS CajasPorCama, dbo.producto_presentacion.nombre AS Presentacion_Producto, 
                         dbo.Nombre_Completo_Ubicacion(dbo.stock.IdUbicacion, dbo.stock.IdBodega) AS Ubicacion_Origen, dbo.trans_oc_pol.codigo_poliza AS No_Poliza, dbo.trans_oc_det.valor_aduana, dbo.trans_oc_det.valor_fob, 
                         dbo.trans_oc_det.valor_iva, dbo.trans_oc_det.valor_dai, dbo.trans_oc_det.valor_seguro, dbo.trans_oc_det.valor_flete, dbo.trans_oc_det.peso_neto, dbo.trans_oc_det.peso_bruto, dbo.trans_oc_pol.numero_orden, 
                         dbo.regimen_fiscal.codigo_regimen, dbo.regimen_fiscal.descripcion AS nombre_regimen, dbo.regimen_fiscal.dias_vencimiento AS dias_vencimiento_regimen, dbo.tms_ticket.Fecha_Ingreso AS Fecha_Ingreso_Ticket_TMS, 
                         dbo.trans_re_enc.fec_agr AS Fecha_Agrego, dbo.producto_estado.nombre AS nom_estado_producto, dbo.trans_oc_enc.No_Ticket_TMS as IdTicketTMS,
			dbo.propietarios.IdPropietario, dbo.producto_clasificacion.IdClasificacion, dbo.producto_clasificacion.Nombre AS Clasificacion, 
			iif(dbo.bodega.es_bodega_fiscal = 1, 'Fiscal','General') AS Regimen
FROM            dbo.propietarios INNER JOIN
                         dbo.propietario_bodega ON dbo.propietarios.IdPropietario = dbo.propietario_bodega.IdPropietario RIGHT OUTER JOIN
                         dbo.tms_ticket RIGHT OUTER JOIN
                         dbo.producto_bodega INNER JOIN
                         dbo.stock INNER JOIN
                         dbo.trans_re_enc ON dbo.stock.IdRecepcionEnc = dbo.trans_re_enc.IdRecepcionEnc INNER JOIN
                         dbo.bodega ON dbo.stock.IdBodega = dbo.bodega.IdBodega INNER JOIN
                         dbo.trans_re_tr ON dbo.trans_re_enc.IdTipoTransaccion = dbo.trans_re_tr.IdTipoTransaccion INNER JOIN
                         dbo.unidad_medida ON dbo.stock.IdUnidadMedida = dbo.unidad_medida.IdUnidadMedida AND dbo.stock.IdUnidadMedida = dbo.unidad_medida.IdUnidadMedida AND 
                         dbo.stock.IdUnidadMedida = dbo.unidad_medida.IdUnidadMedida AND dbo.stock.IdUnidadMedida = dbo.unidad_medida.IdUnidadMedida ON dbo.producto_bodega.IdProductoBodega = dbo.stock.IdProductoBodega AND 
                         dbo.producto_bodega.IdProductoBodega = dbo.stock.IdProductoBodega AND dbo.producto_bodega.IdProductoBodega = dbo.stock.IdProductoBodega AND 
                         dbo.producto_bodega.IdProductoBodega = dbo.stock.IdProductoBodega AND dbo.producto_bodega.IdBodega = dbo.bodega.IdBodega INNER JOIN
                         dbo.producto ON dbo.producto_bodega.IdProducto = dbo.producto.IdProducto INNER JOIN
                         dbo.producto_estado ON dbo.stock.IdProductoEstado = dbo.producto_estado.IdEstado AND dbo.stock.IdProductoEstado = dbo.producto_estado.IdEstado AND dbo.stock.IdProductoEstado = dbo.producto_estado.IdEstado AND 
                         dbo.stock.IdProductoEstado = dbo.producto_estado.IdEstado LEFT OUTER JOIN
                         dbo.trans_oc_det INNER JOIN
                         dbo.trans_oc_enc INNER JOIN
                         dbo.trans_re_oc ON dbo.trans_oc_enc.IdOrdenCompraEnc = dbo.trans_re_oc.IdOrdenCompraEnc ON dbo.trans_oc_det.IdOrdenCompraEnc = dbo.trans_oc_enc.IdOrdenCompraEnc ON 
                         dbo.stock.IdProductoBodega = dbo.trans_oc_det.IdProductoBodega AND dbo.trans_re_enc.IdRecepcionEnc = dbo.trans_re_oc.IdRecepcionEnc ON dbo.tms_ticket.IdTicket = dbo.trans_oc_enc.No_Ticket_TMS ON 
                         dbo.propietario_bodega.IdPropietarioBodega = dbo.stock.IdPropietarioBodega AND dbo.propietario_bodega.IdPropietarioBodega = dbo.stock.IdPropietarioBodega AND 
                         dbo.propietario_bodega.IdPropietarioBodega = dbo.stock.IdPropietarioBodega AND dbo.propietario_bodega.IdPropietarioBodega = dbo.stock.IdPropietarioBodega LEFT OUTER JOIN
                         dbo.producto_presentacion ON dbo.stock.IdPresentacion = dbo.producto_presentacion.IdPresentacion AND dbo.stock.IdPresentacion = dbo.producto_presentacion.IdPresentacion AND 
                         dbo.stock.IdPresentacion = dbo.producto_presentacion.IdPresentacion AND dbo.stock.IdPresentacion = dbo.producto_presentacion.IdPresentacion LEFT OUTER JOIN
                         dbo.regimen_fiscal INNER JOIN
                         dbo.trans_oc_pol ON dbo.regimen_fiscal.IdRegimen = dbo.trans_oc_pol.IdRegimen ON dbo.trans_oc_enc.IdOrdenCompraEnc = dbo.trans_oc_pol.IdOrdenCompraEnc LEFT OUTER JOIN
                         dbo.proveedor INNER JOIN
                         dbo.proveedor_bodega ON dbo.proveedor.IdProveedor = dbo.proveedor_bodega.IdProveedor ON dbo.trans_oc_enc.IdProveedorBodega = dbo.proveedor_bodega.IdAsignacion
						 LEFT OUTER JOIN dbo.producto_clasificacion ON dbo.producto.IdClasificacion = producto_clasificacion.IdClasificacion
GROUP BY dbo.stock.IdBodega, dbo.stock.IdStock, dbo.stock.IdPropietarioBodega, dbo.stock.IdProductoBodega, dbo.stock.IdProductoEstado, dbo.stock.IdPresentacion, dbo.stock.IdUnidadMedida, dbo.stock.IdUbicacion, 
                         dbo.stock.IdUbicacion_anterior, dbo.stock.IdRecepcionEnc, dbo.stock.IdRecepcionDet, dbo.stock.IdPedidoEnc, dbo.stock.IdPickingEnc, dbo.stock.IdDespachoEnc, dbo.stock.lote, dbo.stock.lic_plate, dbo.stock.serial, 
                         dbo.stock.cantidad, dbo.stock.fecha_ingreso, dbo.stock.fecha_vence, dbo.stock.uds_lic_plate, dbo.stock.no_bulto, dbo.stock.fecha_manufactura, dbo.stock.añada, dbo.stock.user_agr, dbo.stock.fec_agr, dbo.stock.user_mod, 
                         dbo.stock.fec_mod, dbo.stock.peso, dbo.stock.temperatura, dbo.stock.atributo_variante_1, dbo.propietarios.nombre_comercial, dbo.proveedor.nombre, dbo.bodega.nombre, dbo.trans_oc_enc.IdOrdenCompraEnc, 
                         dbo.trans_oc_enc.No_Documento, dbo.trans_oc_enc.Referencia, dbo.trans_re_oc.no_docto, dbo.trans_re_enc.fecha_recepcion, dbo.trans_re_tr.TipoTrans, dbo.unidad_medida.Nombre, dbo.producto.codigo, 
                         dbo.producto.nombre, dbo.producto.codigo_barra, ISNULL(dbo.producto_presentacion.factor, 0), ISNULL(dbo.producto_presentacion.CamasPorTarima, 0), ISNULL(dbo.producto_presentacion.CajasPorCama, 0), 
                         dbo.producto_presentacion.nombre, dbo.Nombre_Completo_Ubicacion(dbo.stock.IdUbicacion, dbo.stock.IdBodega), dbo.trans_oc_pol.codigo_poliza, dbo.trans_oc_det.valor_aduana, dbo.trans_oc_det.valor_fob, 
                         dbo.trans_oc_det.valor_iva, dbo.trans_oc_det.valor_dai, dbo.trans_oc_det.valor_seguro, dbo.trans_oc_det.valor_flete, dbo.trans_oc_det.peso_neto, dbo.trans_oc_det.peso_bruto, dbo.trans_oc_pol.numero_orden, 
                         dbo.regimen_fiscal.codigo_regimen, dbo.regimen_fiscal.descripcion, dbo.regimen_fiscal.dias_vencimiento, dbo.tms_ticket.Fecha_Ingreso, dbo.trans_re_enc.fec_agr, dbo.producto_estado.nombre, dbo.stock.activo, 
                         dbo.stock.pallet_no_estandar, dbo.producto_presentacion.factor, dbo.trans_oc_enc.No_Ticket_TMS, dbo.propietarios.IdPropietario, dbo.producto_clasificacion.IdClasificacion, dbo.producto_clasificacion.nombre, dbo.bodega.es_bodega_fiscal
GO
