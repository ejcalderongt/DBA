/****** Object:  View [dbo].[VW_Doc_Con_Diferencias]    Script Date: 5/02/2021 11:17:11 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

create View [dbo].[VW_Doc_Con_Diferencias] as
SELECT ENC.NO_DOCUMENTO AS ORDENCOMPRA,DET.CODIGO_PRODUCTO,DET.NOMBRE_PRODUCTO,DET.CANTIDAD,DET.CANTIDAD_RECIBIDA,
CASE WHEN ISNULL(DET.IdPresentacion,0)=0 THEN um.Nombre ELSE pr.nombre END AS UM,
DET.CANTIDAD_RECIBIDA -DET.CANTIDAD AS DIFERENCIA,ENC.IDPROPIETARIOBODEGA,BODEGA.NOMBRE_COMERCIAL AS BODEGA,
PROP.NOMBRE_COMERCIAL AS PROPIETARIO,ENC.IDPROVEEDORBODEGA,ENC.IDTIPOINGRESOOC,TIPO.NOMBRE AS NOMBRE_INGRESOOC,
DET.IDPRODUCTOBODEGA,DET.IDPRESENTACION, DET.IDUNIDADMEDIDABASICA, ESTADO.NOMBRE AS ESTADO ,DET.ACTIVO,ENC.FECHA_CREACION
FROM TRANS_OC_ENC ENC INNER JOIN TRANS_OC_DET DET ON ENC.IDORDENCOMPRAENC = DET.IDORDENCOMPRAENC INNER JOIN TRANS_OC_TI TIPO
ON ENC.IDTIPOINGRESOOC = TIPO.IDTIPOINGRESOOC INNER JOIN PROPIETARIO_BODEGA PROP_BD on ENC.IDPROPIETARIOBODEGA=PROP_BD.IDPROPIETARIOBODEGA
INNER JOIN TRANS_OC_ESTADO ESTADO ON ENC.IDESTADOOC= ESTADO.IDESTADOOC
INNER JOIN BODEGA ON PROP_BD.IdBodega = bodega.IDBODEGA
INNER JOIN propietarios PROP ON PROP_BD.IdPropietario = PROP.IDPROPIETARIO
INNER JOIN unidad_medida um ON um.IdUnidadMedida = det.IdUnidadMedidaBasica
LEFT JOIN producto_presentacion pr ON det.IdPresentacion = pr.IdPresentacion
WHERE  TIPO.ACTIVO =1 and ESTADO.IdEstadoOC <> 5 


GO
