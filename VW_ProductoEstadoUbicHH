CREATE VIEW [dbo].[VW_ProductoEstadoUbicHH]
AS
SELECT  ISNULL(pe.IdUbicacionDefecto,0) AS IdUbicacion,
        e.IdEstado, 
		ISNULL(pe.IdBodega, 0) AS IdBodega, 
		CASE WHEN ISNULL(pe.IdUbicacionDefecto,0)=0 THEN 'N/D' ELSE dbo.Nombre_Completo_Ubicacion(pe.IdUbicacionDefecto, pe.IdBodega) END AS NombreUbic
FROM  dbo.producto_estado AS e INNER JOIN
      dbo.propietarios AS p ON e.IdPropietario = p.IdPropietario LEFT JOIN
      dbo.producto_estado_ubic AS pe ON pe.IdEstado = e.IdEstado LEFT JOIN 
      dbo.bodega_ubicacion AS u ON u.IdUbicacion = e.IdUbicacionDefecto AND pe.IdUbicacionDefecto = u.IdUbicacion
GO
